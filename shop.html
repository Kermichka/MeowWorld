<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>MeowWorld</title>
    <style>
        .navbar {
            opacity: 0.8;
        }

        .navbar-nav {
            margin: auto;
        }

        .nav-link {
            margin-right: 20px;
        }

        .navbar-dark .navbar-nav .nav-link {
            color: white;
        }

        .row-with-background {
            background-image: url('shopPhotos/catEating.png');
            background-repeat: no-repeat;
            background-size: cover;
            background-position: center;
            height: 700px;
        }

        .black-row-white-text {
            background-color: black;
            color: white;
            margin: 0px;
            padding: 0px;
        }

        .boxes {
            height: 400px;
            margin: 20px;
            padding: 5px;
            background-color: rgb(208, 208, 208);
            color: black;
            font-size: 40px;
            transition: all 0.3s ease-in-out;
            background-size: cover;
            background-position: center;
            text-align: center;
            font-family: 'Times New Roman';
        }

        .boxes.box1 {
            background-image: url('shopPhotos/catFood.jpeg');
        }

        .boxes.box2 {
            background-image: url('shopPhotos/catFood2.jpeg');
        }

        .boxes.box3 {
            background-image: url('shopPhotos/catFood3.jpeg');
        }

        .boxes:hover {
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            transform: scale(1.05);
        }

        .text-rows {
            padding: 30px;
        }

        .text-rows h1 {
            font-size: 40px;
            font-weight: 400;
        }

        .text-rows li {
            font-size: 30px;
            font-weight: 300;
        }

        .text-rows p {
            font-size: 30px;
            font-weight: 300;
        }

        .cart-item-price {
            text-align: right;
        }

        /* Additional Styles for Small Screens */
        @media (max-width: 991px) {

            .text-rows h1 {
                font-size: 30px;
                font-weight: 400;
            }

            .text-rows p {
                font-size: 20px;
                font-weight: 300;
            }

        }

        @media (max-width: 767px) {

            .text-rows h1 {
                font-size: 30px;
                font-weight: 400;
            }

            .text-rows p {
                font-size: 20px;
                font-weight: 300;
            }

        }
    </style>
</head>

<body>
    <nav class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <h1>MeowWorld</h1>
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav mx-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="breeds.html">Breeds</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="entertainment.html">Entertainment</a>
                    </li>
                    <li>
                        <a class="nav-link" href="shop.html">Shop</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="cartToggle" data-bs-toggle="modal" data-bs-target="#cartModal">
                            CART <span id="cartPrice"></span>
                        </a>
                    </li>


                </ul>
            </div>
        </div>
    </nav>
    <div class="container-fluid">

        <div class="modal fade" id="productModal" tabindex="-1" role="dialog" aria-labelledby="productModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="productModalLabel">Product Selection</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>How many products do you want?</p>
                        <p id="productName"></p>
                        <p id="productPrice"></p>
                        <input type="number" id="productCount" class="form-control">
                        <p id="total"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="saveProductsBtn">Save</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="cartModal" tabindex="-1" role="dialog" aria-labelledby="cartModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="cartModalLabel">Cart</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body" id="cartItems">
                        <!-- Selected products will be dynamically added here -->
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="row row-with-background"></div>
        <div class="container">
            <div class="row text-rows">
                <h1>Shopping online for cats</h1>
                <p>Welcome to MeowWorld's Cat Food Shop! We offer a premium selection of high-quality cat
                    food products to keep your feline companions happy and healthy. From wet food to dry kibble,
                    we have the perfect options to satisfy even the pickiest eaters. Shop with confidence knowing
                    that each product is carefully curated to meet your cat's nutritional needs. Discover the best
                    for your furry friends at MeowWorld's Cat Food Shop.</p>
            </div>
        </div>
        <div class="container">
            <div class="row text-rows">
                <div class="row gx-5">
                    <div class="col">
                        <div class="boxes box1" data-bs-toggle="modal" data-bs-target="#productModal"
                            data-product="Meow Mix" data-price="549">

                        </div>
                        <p>Meow Mix $5.49</p>
                    </div>
                    <div class="col">
                        <div class="boxes box2" data-bs-toggle="modal" data-bs-target="#productModal"
                            data-product="9Lives" data-price="399">

                        </div>
                        <p>9Lives $3.99</p>
                    </div>

                    <div class="col">
                        <div class="boxes box3" data-bs-toggle="modal" data-bs-target="#productModal"
                            data-product="Instinct" data-price="799">

                        </div>
                        <p>Instinct $7.99</p>
                    </div>
                </div>
            </div>
        </div>
        <div style=" background-color: gray;color:white;">
            <div class="container">
                <div id="Contacts" class="row">

                    <div class="col text-rows">
                        <h1>ContCAT us</h1>
                        <p>
                            <br>GSM: +359 88 ### ####
                            <br>Adress: st. ####, Ruse, Bulgaria
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!--
intl, Вътре в количката да се променя броят на продуктите. 
Подраняване вдясно. При закупуване броя на продуктите да е от количката. 
Remove бутон.-->

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
        <script>
            const cart = [];
            const savedCart = localStorage.getItem("cart");
            if (savedCart) {
                try {
                    const parsedCart = JSON.parse(savedCart);
                    cart.concat(parsedCart);
                } catch (error) {
                    console.error("Error parsing saved products data.");
                }
            }

            const priceFormatter = Intl.NumberFormat("en-us", {
                style: "currency",
                currency: "usd",
            });
            document.addEventListener("DOMContentLoaded", function () {
                const saveProductsBtn = document.getElementById("saveProductsBtn");
                const productCountInput = document.getElementById("productCount");
                let clickedBox = null;
                const productBoxes = document.querySelectorAll(".boxes");
                productBoxes.forEach(function (productBox) {
                    productBox.addEventListener("click", function (event) {
                        productCountInput.value = 1;
                        const productName = event.currentTarget.getAttribute("data-product");
                        const productPrice = event.currentTarget.getAttribute("data-price");
                        const productPriceFormatted = priceFormatter.format(productPrice / 100);
                        document.getElementById("productName").textContent = productName;
                        document.getElementById("productPrice").dataset.price = productPrice;
                        document.getElementById("productPrice").textContent = productPriceFormatted;
                        updateProductTotal();
                    });
                });

                productCountInput.addEventListener("input", function () {
                    updateProductTotal();
                });

                saveProductsBtn.addEventListener("click", function () {
                    const productName = document.getElementById("productName").textContent;
                    const productCount = parseInt(productCountInput.value);
                    const productPrice = parseInt(document.getElementById("productPrice").dataset.price);
                    setCartItemQuantity(productName, productCount, productPrice);
                    const modal = bootstrap.Modal.getInstance(
                        document.getElementById("productModal")
                    );
                    modal.hide();

                    updateCart(getTotal());
                });
                const cartToggle = document.getElementById("cartToggle");

                cartToggle.addEventListener("click", function () {
                    showCart();
                });

                function removeFromCart(cartItem) {

                }

                function updateProductTotal() {
                    const productPrice = document.getElementById("productPrice").dataset.price;
                    const productCount = parseInt(productCountInput.value);
                    const total = productCount * productPrice;
                    const totalFormatted = priceFormatter.format(total / 100);
                    document.getElementById("total").textContent = `Total: ${totalFormatted}`;
                }

                function getTotal() {
                    let total = 0;
                    for (const cartItem of cart) {
                        total += cartItem.quantity * cartItem.price;
                    }
                    return total;
                }
                function setCartItemQuantity(productName, quantity, price) {
                    const cartItem = cart.find(cartItem => cartItem.name === productName);
                    if (quantity === 0) {
                        if (cartItem) {
                            const cartItemIndex = cart.indexOf(cartItem);
                            cart.splice(cartItemIndex, 1);
                        }
                    }
                    else {
                        if (cartItem) {
                            cartItem.quantity = quantity;
                        } else {
                            if (!price) {
                                throw new Error("Price is required!");
                            }
                            cart.push({
                                name: productName,
                                quantity,
                                price,
                            });
                        }
                    }
                    localStorage.setItem("cart", JSON.stringify(cart));
                }
                function showCart() {
                    const cartItems = document.getElementById("cartItems");
                    cartItems.innerHTML = "";

                    if (cart.length === 0) {
                        const emptyCartMessage = document.createElement("p");
                        emptyCartMessage.textContent = "Your cart is empty. Do you want to add 1 Meow Mix - $5.49?";
                        const addButton = document.createElement("button");
                        addButton.textContent = "Add Product";
                        addButton.addEventListener("click", function () {
                            setCartItemQuantity("Meow Mix", 1, 549);
                            showCart();
                        });
                        cartItems.appendChild(emptyCartMessage);
                        cartItems.appendChild(addButton);
                    } else {
                        for (const cartItem of cart) {
                            if (cartItem.quantity === 0) {
                                setCartItemQuantity(cartItem.name, 0);
                                showCart();
                            } else if (cartItem.quantity > 0) {
                                const cartItemElem = document.createElement("div");
                                cartItemElem.classList.add("cart-item");

                                const cartItemInfo = document.createElement("p");
                                cartItemInfo.innerText = `${cartItem.name}: ${cartItem.quantity} x ${priceFormatter.format(cartItem.price / 100)}`;

                                const cartItemPrice = document.createElement("p");
                                cartItemPrice.classList.add("cart-item-price")
                                cartItemPrice.innerText = `${priceFormatter.format((cartItem.price / 100) * cartItem.quantity)}`;

                                const buttonsContainer = document.createElement("div");
                                buttonsContainer.classList.add("buttons-container", "cart-item-price");

                                const addButton = document.createElement("button");
                                addButton.innerText = "+";
                                addButton.addEventListener("click", function () {
                                    setCartItemQuantity(cartItem.name, cartItem.quantity + 1);
                                    showCart();
                                });

                                const removeButton = document.createElement("button");
                                removeButton.innerText = "-";
                                removeButton.addEventListener("click", function () {
                                    setCartItemQuantity(cartItem.name, cartItem.quantity - 1);
                                    showCart();
                                });

                                const removeAllButton = document.createElement("button");
                                removeAllButton.innerText = "Remove All";
                                removeAllButton.addEventListener("click", function () {
                                    setCartItemQuantity(cartItem.name, 0);
                                    showCart();
                                });

                                buttonsContainer.appendChild(addButton);
                                buttonsContainer.appendChild(removeButton);
                                buttonsContainer.appendChild(removeAllButton);

                                cartItemElem.appendChild(cartItemInfo);
                                cartItemElem.appendChild(cartItemPrice);
                                cartItemElem.appendChild(buttonsContainer);

                                cartItems.appendChild(cartItemElem);
                            }
                        }
                    }
                    if (getTotal() > 0) {
                        const addTotal = document.createElement("div");
                        const addTotalText = document.createElement("p");
                        addTotal.innerText = "Total: ";
                        const addTotalPrice = document.createElement("p");
                        addTotalPrice.classList.add("cart-item-price");
                        addTotalPrice.innerText = priceFormatter.format(getTotal() / 100);
                        addTotal.appendChild(addTotalText);
                        addTotal.appendChild(addTotalPrice);
                        cartItems.appendChild(addTotal);
                    }
                    updateCart(getTotal());
                }
            });
            function updateCart(price) {
                const cartPriceElement = document.getElementById("cartPrice");
                let totalProducts = 0;
                for (const cartItem of cart) {
                    totalProducts += cartItem.quantity
                }
                cartPriceElement.innerText = `(${totalProducts}, ${priceFormatter.format(price / 100)})`;
            }
        </script>

</body>

</html>